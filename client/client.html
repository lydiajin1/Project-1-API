<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Movies API</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>
    <div class="section pb-3" style="background: linear-gradient(135deg, #9099e2 0%, #4b4bcf 100%);">
        <h1 class="title is-2 has-text-white has-text-centered"> Disney Movies API </h1>
    </div>

    <div class="section has-background-light">
        <div class="container" style="max-width: 1000px;">
            <section class="endpoint-docs">
                <h2 class="endpoint-title button column is-12 has-text-left is-link is-size-4">
                    /getMovieTitles
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #A8E6CF; color: #2D5F4D;">GET</span>
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #FFD4A3; color: #8B5A00;">HEAD</span>
                </h2>
                <div class="endpoint-details has-background-white-ter px-4 py-4">
                    <form id="getMovieTitlesForm" action="/getMovieTitles" method="GET">
                        <div class="field">
                            <label class="label">Actor:</label>
                            <div class="control">
                                <input class="input" type="text" name="actor">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Year:</label>
                            <div class="control">
                                <input class="input" type="text" name="year">
                            </div>
                        </div>
                        <div class="field">
                            <label class="radio">
                                <input type="radio" name="method" value="GET" checked> GET
                            </label>
                            <label class="radio">
                                <input type="radio" name="method" value="HEAD"> HEAD
                            </label>
                        </div>
                        <button type="submit" class="button is-link is-rounded">Send Request</button>
                        <div class="result-content"></div>
                    </form>
                </div>
            </section>

            <section class="endpoint-docs">
                <h2 class="endpoint-title button column is-12 has-text-left is-link is-size-4">
                    /getTopRated
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #A8E6CF; color: #2D5F4D;">GET</span>
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #FFD4A3; color: #8B5A00;">HEAD</span>
                </h2>
                <div class="endpoint-details has-background-white-ter px-4 py-4">
                    <form id="getTopRatedForm" action="/getTopRated" method="GET">
                        <div class="field">
                            <label class="label">Min Rating:</label>
                            <div class="control">
                                <input class="input" type="number" name="minRating" step="0.1">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Limit:</label>
                            <div class="control">
                                <input class="input" type="number" name="limit" step="1">
                            </div>
                        </div>
                        <div class="field">
                            <label class="radio">
                                <input type="radio" name="method" value="GET" checked> GET
                            </label>
                            <label class="radio">
                                <input type="radio" name="method" value="HEAD"> HEAD
                            </label>
                        </div>
                        <button type="submit" class="button is-link is-rounded">Send Request</button>
                        <div class="result-content"></div>
                    </form>
                </div>
            </section>

            <section class="endpoint-docs">
                <h2 class="endpoint-title button column is-12 has-text-left is-link is-size-4">
                    /getByDecade
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #A8E6CF; color: #2D5F4D;">GET</span>
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #FFD4A3; color: #8B5A00;">HEAD</span>
                </h2>
                <div class="endpoint-details has-background-white-ter px-4 py-4">
                    <form id="getByDecadeForm" action="/getByDecade" method="GET">
                        <div class="field">
                            <label class="label">Decade:</label>
                            <div class="control">
                                <input class="input" type="number" name="decade" placeholder="e.g., 1990">
                            </div>
                        </div>
                        <div class="field">
                            <label class="radio">
                                <input type="radio" name="method" value="GET" checked> GET
                            </label>
                            <label class="radio">
                                <input type="radio" name="method" value="HEAD"> HEAD
                            </label>
                        </div>
                        <button type="submit" class="button is-link is-rounded">Send Request</button>
                        <div class="result-content"></div>
                    </form>
                </div>
            </section>

            <section class="endpoint-docs">
                <h2 class="endpoint-title button column is-12 has-text-left is-link is-size-4">
                    /getByRuntime
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #A8E6CF; color: #2D5F4D;">GET</span>
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #FFD4A3; color: #8B5A00;">HEAD</span>
                </h2>
                <div class="endpoint-details has-background-white-ter px-4 py-4">
                    <form id="getByRuntimeForm" action="/getByRuntime" method="GET">
                        <div class="field">
                            <label class="label">Min Runtime (minutes):</label>
                            <div class="control">
                                <input class="input" type="number" name="min" min="0">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Max Runtime (minutes):</label>
                            <div class="control">
                                <input class="input" type="number" name="max" min="0">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Limit:</label>
                            <div class="control">
                                <input class="input" type="number" name="limit" min="1">
                            </div>
                        </div>
                        <div class="field">
                            <label class="radio">
                                <input type="radio" name="method" value="GET" checked> GET
                            </label>
                            <label class="radio">
                                <input type="radio" name="method" value="HEAD"> HEAD
                            </label>
                        </div>
                        <button type="submit" class="button is-link is-rounded">Send Request</button>
                        <div class="result-content"></div>
                    </form>
                </div>
            </section>

            <section class="endpoint-docs">
                <h2 class="endpoint-title button column is-12 has-text-left is-link is-size-4">
                    /addMovie
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #FFB3BA; color: #8B0000;">POST</span>
                </h2>
                <div class="endpoint-details has-background-white-ter px-4 py-4">
                    <form id="addMovieForm" action="/addMovie" method="POST">
                        <div class="field">
                            <label class="label">Title:</label>
                            <div class="control">
                                <input class="input" type="text" name="title">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Year:</label>
                            <div class="control">
                                <input class="input" type="number" name="year">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Runtime (minutes):</label>
                            <div class="control">
                                <input class="input" type="number" name="runtime">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Rating (0-10):</label>
                            <div class="control">
                                <input class="input" type="number" name="rating" step="0.1">
                            </div>
                        </div>
                        <button type="submit" class="button is-link is-rounded">Add Movie</button>
                        <div class="result-content"></div>
                    </form>
                </div>
            </section>

            <section class="endpoint-docs">
                <h2 class="endpoint-title button column is-12 has-text-left is-link is-size-4">
                    /rateMovie
                    <span class="tag m-1 has-text-weight-bold"
                        style="background-color: #FFB3BA; color: #8B0000;">POST</span>
                </h2>
                <div class="endpoint-details has-background-white-ter px-4 py-4">
                    <form id="rateMovieForm" action="/rateMovie" method="POST">
                        <div class="field">
                            <label class="label">Title:</label>
                            <div class="control">
                                <input class="input" type="text" name="title">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Rating (0-10):</label>
                            <div class="control">
                                <input class="input" type="number" name="rating" step="0.1">
                            </div>
                        </div>
                        <button type="submit" class="button is-link is-rounded">Rate Movie</button>
                        <div class="result-content"></div>
                    </form>
                </div>
            </section>
        </div>
    </div>

    <footer class="footer has-text-centered">
        <p style="color: #6B4FBB;"> Lydia Jin - 2025 - IGME 430 Project 1 </p>
        <p><a href="/documentation.html" style="color: #FF69B4; text-decoration: underline;">View API
                Documentation</a></p>
    </footer>
</body>

<script>
    // Code taken from W3 school to make collapsible sections for endpoints
    // https://www.w3schools.com/howto/howto_js_collapsible.asp
    var coll = document.getElementsByClassName("endpoint-title");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.display === "block") {
                content.style.display = "none";
            } else {
                content.style.display = "block";
            }
        });
    }

    const handleResponse = async (response, method, form) => {
        const content = form.querySelector('.result-content');

        // Display status message based on status code
        switch (response.status) {
            case 200:
                content.innerHTML = `<p class="is-size-6 mb-1 has-text-success"><b>Success</b></p>`;
                break;
            case 201:
                content.innerHTML = `<p class="is-size-6 mb-1 has-text-success"><b>Created</b></p>`;
                break;
            case 204:
                content.innerHTML = `<p class="is-size-6 mb-1 has-text-success"><b>Updated (No Content)</b></p>`;
                break;
            case 400:
                content.innerHTML = `<p class="is-size-6 mb-1 has-text-danger"><b>Bad Request</b></p>`;
                break;
            case 404:
                content.innerHTML = `<p class="is-size-6 mb-1 has-text-danger"><b>Not Found</b></p>`;
                break;
            default:
                content.innerHTML = `<p class="is-size-6 mb-1 has-text-danger"><b>Error</b></p>`;
                break;
        }

        // Display status and content-length
        content.innerHTML += `<p class="my-0"><b>Status: </b>${response.status}</p>`;
        content.innerHTML += `<p class="my-0"><b>Content-Length: </b>${response.headers.get('Content-Length')}</p>`;

        // Parse and display JSON response (skip for HEAD and 204)
        if (method !== 'HEAD' && response.status !== 204) {
            try {
                const obj = await response.json();

                if (obj.error) {
                    content.innerHTML += `<p class="my-0"><b>Error: </b>${JSON.stringify(obj)}</p>`;
                } else {
                    content.innerHTML += `<p class="my-0"><b>Response: </b>${JSON.stringify(obj)}</p>`;
                }
            } catch (e) {
                content.innerHTML += `<p class="my-0"><b>Response: </b>Unable to parse JSON</p>`;
            }
        }
    };

    const requestUpdate = async (form) => {
        const method = form.querySelector('input[name="method"]:checked').value;
        let url = form.getAttribute('action');
        let params = '?';

        // Parameter options for GET/HEAD requests
        const paramOptions = ['actor', 'year', 'minRating', 'limit', 'decade', 'min', 'max'];

        paramOptions.forEach(option => {
            const field = form.querySelector(`input[name="${option}"]`);
            // Check if parameter exists and has a value
            if (field && field.value) {
                // Build params in URL encoded format
                params += `${option}=${encodeURIComponent(field.value)}&`;
            }
        });

        // Add params to URL
        url += params;
        // Cut off '&' from end or '?' if no params
        url = url.slice(0, -1);

        const response = await fetch(url, {
            method: method,
            headers: {
                'Accept': 'application/json',
            }
        });

        handleResponse(response, method, form);
    };

    const sendPost = async (form) => {
        const url = form.getAttribute('action');
        const method = form.getAttribute('method');
        let formData = '';

        // Data options for POST requests
        const dataOptions = ['title', 'year', 'runtime', 'rating'];

        dataOptions.forEach(option => {
            const field = form.querySelector(`input[name="${option}"]`);
            // Check if data option exists and has a value
            if (field && field.value) {
                // Build formData in URL encoded format
                formData += `${option}=${encodeURIComponent(field.value)}&`;
            }
        });

        // Cut off '&' from end if formData has content
        if (formData.length !== 0) {
            formData = formData.slice(0, -1);
        }

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Accept': 'application/json',
            },
            body: formData
        });

        handleResponse(response, method, form);
    };

    // Initialize event listeners on forms
    const init = () => {
        console.log('Init called');
        const getForms = document.querySelectorAll('form[method="GET"]');
        const postForms = document.querySelectorAll('form[method="POST"]');

        console.log('GET forms:', getForms.length);
        console.log('POST forms:', postForms.length);

        // Add event listeners for GET and HEAD forms
        getForms.forEach(form => {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                requestUpdate(form);
                return false;
            });
        });

        // Add event listeners for POST forms
        postForms.forEach(form => {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                sendPost(form);
                return false;
            });
        });
    };

    window.onload = init;
</script>

</html>